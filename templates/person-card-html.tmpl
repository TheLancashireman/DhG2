{# person-card-html.tmpl - a template for an individual's family and timeline in HTML

	(c) David Haworth

	This file is part of DhG.

	DhG is free software: you can redistribute it and/or modify
	it under the terms of the GNU General Public License as published by
	the Free Software Foundation, either version 3 of the License, or
	(at your option) any later version.

	DhG is distributed in the hope that it will be useful,
	but WITHOUT ANY WARRANTY; without even the implied warranty of
	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
	GNU General Public License for more details.

	You should have received a copy of the GNU General Public License
	along with DhG.  If not, see <http://www.gnu.org/licenses/>.

	Input is a dictionary containing the following items:
		cardbase	: the server's 'cards' directory
		subj		: the subject of the card
		father		: the subject's father
		mother		: the subject's mother
		siblings	: a list of siblings of the subject, ordered by DoB
		others		: a list of other parents of half-siblings
		partners	: a list of all the other parents of the children, in order of the children's DoB
		children	: a list of children of the subject, ordered by DoB
		notes		: a list of general information about the person
		events		: a list of events from the person's timeline
		transcripts	: a list of transcripts referenced from the events
		files		: a list of image/transcript files referenced from the events
		timestamp	: date and time of generation

	Each person in the above dictionary is an instance of a class with the following members:
		name		: the person's name
		dob_dod		: (DoB - DoD)
		vital		: string containing name and dob_dod
		file		: basename of file, including surname directory
		other		: in siblings list: index of other parent in others list
					: in others list: relationship to half-sibling (mother/father)
					: in children list: unique id of other parent (partner)

	Each event in the events list is an instance of a class with the following members:
		date		: the date of the event
		evtype		: what kind of event: Birth, Marriage etc.
		person		: person connected with the event (e.g. spouse for marriages) (optional)
		info		: list of information. Each is a (name, value, URL) tuple (or class?)
		sources		: list of sources. Each is a name, along with a list of links (web or local)

	Each transcript in the transcripts list is an instance of a class with the following members:
		id			: Identifier. Used as anchor and in the ref column.
		text		: text of the transcript

	Each file in the files list is an instance of a class with the following members:
		id			: Identifier. Used as anchor and in the ref column
		type		: Image, transcript, document with page no...
		filename	: Unique name of the file
-#}
{%  set CARDBASE = tp['cardbase'] %}
{%  set HEAD = 'html-head.tmpl' %}
{%  set FOOT = 'html-foot.tmpl' %}
{%  include HEAD +%}

{%  set subj = tp['subj'] %}
  <h1>{{ subj.name }}</h1>
{%  if subj.dob_dod != None %}
  <h2>{{ subj.dob_dod }}</h2>
{%  endif %}
  <hr>

  <table class="general-info">
{%  set father = tp['father'] %}
    <tr class="general-info">
      <td class="general-info-caption">
        Father:
      </td>
      <td class="general-info-value">
{%  if father == None %}
        not known
{%  else %}
{%    if father.file == None %}
        {{ father.vital }}
{%    else %}
        <a href="{{ CARDBASE }}/{{ father.file }}.html">{{ father.vital }}</a>
{%    endif %}
{%  endif %}
      </td>
    </tr>
{%  set mother = tp['mother'] %}
    <tr class="general-info">
      <td class="general-info-caption">
        Mother:
      </td>
      <td class="general-info-value">
{%  if mother == None %}
        not known
{%  else %}
{%    if mother.file == None %}
        {{ mother.vital }}
{%    else %}
        <a href="{{ CARDBASE }}/{{ mother.file }}.html">{{ mother.vital }}</a>
{%    endif %}
{%  endif %}
      </td>
    </tr>
  </table>

  <table class="family">
    <tr class="family">
      <td class="siblings">
        <h4>Siblings:</h4>
{%  set siblings = tp['siblings'] %}
{%  if siblings == None %}
          None
{%  else %}
        <ul class="siblings">
{%    for sib in siblings %}
          <li class="siblings">
{%      if sib.file == None %}
            {{ sib.vital }}
{%      else %}
            <a href="{{ CARDBASE }}/{{ sib.file }}.html">{{ sib.vital }}</a>
{%      endif %}
{%      if sib.other != None %}
<sup>{{ sib.other }}</sup>
{%      endif %}
          </li>
{%    endfor %}
{%  endif %}
        </ul>
{%  set other_parents = tp['others'] %}
{%  if other_parents != None %}
        Other parents of half-siblings:<br>
        <ol class="siblings">
{%    for op in other_parents %}
{%      if op.file == None %}
          <li>{{ op.other }}: {{ op.name }}</li>
{%      else %}
          <li>{{ op.other }}: <a href="{{ CARDBASE }}/{{ op.file }}.html">{{ op.name }}</a></li>
{%      endif %}
{%    endfor %}
        </ol>
{%  endif %}
      </td>
      <td class="children">
        <h4>Children:</h4>
{%  set partners = tp['partners'] %}
{%  if partners == None %}
        None
{%  else %}
{%    for sp in partners %}
{%      if sp.file == None %}
        {{ subj.name }} + {{ sp.name }}
{%      else %}
        {{ subj.name }} + <a href="{{ CARDBASE }}/{{ sp.file }}.html">{{ sp.name }}</a>
{%      endif %}
        <ul class="children">
{%      for ch in tp['children'] if ch.other == sp.uniq %}
          <li class="children">
{%        if ch.file == None %}
            {{ ch.vital }}
{%        else %}
            <a href="{{ CARDBASE }}/{{ ch.file }}.html">{{ ch.vital }}</a>
{%        endif %}
          </li>
{%      endfor %}
        </ul>
{%    endfor %}
{%  endif %}
      </td>
    </tr>
  </table>
  <p>
  </p>
{%  set events = tp['events'] %}
{%  if events != None %}

  <hr>

  <h3>Timeline</h3>
  <table class="timeline">
    <tr class="timeline">
      <td class="timeline-date-even">
      </td>
      <td class="timeline-event-even">
      </td>
      <td class="timeline-info-even">
      </td>
      <td class="timeline-source-even">
      </td>
    </tr>
    <tr class="timeline">
      <td class="timeline-date-odd">
      </td>
      <td class="timeline-event-odd">
      </td>
      <td class="timeline-info-odd">
      </td>
      <td class="timeline-source-odd">
      </td>
    </tr>
  </table>
  <p>
  </p>
{%  endif %}
{%  set transcripts = tp['transcripts'] %}
{%  if transcripts != None %}

  <hr>

  <h3>Transcripts of sources</h3>      
  <table class="transcripts">
    <tr class="transcripts" id="transcript_1">
      <td class="transcript-index-even">
      </td>
      <td class="transcript-text-even">
        <pre>
        </pre>
      </td>
    </tr>
    <tr class="transcripts" id="transcript_2">
      <td class="transcript-index-odd">
      </td>
      <td class="transcript-text-odd">
        <pre>
        </pre>
      </td>
    </tr>
  </table>
  <p>
  </p>
{%  endif %}
{%  set files = tp['files'] %}
{%  if files != None %}

  <hr>

  <h3>File sources</h3>      
  <table class="images">
    <tr class="images" id="image_1">
      <td class="image-index-even">
      </td>
      <td class="image-text-even">
      </td>
    </tr>
    <tr class="images" id="image_2">
      <td class="image-index-odd">
      </td>
      <td class="image-text-odd">
      </td>
    </tr>
  </table>
  <p>
  </p>
{%  endif %}

{%  include FOOT +%}
